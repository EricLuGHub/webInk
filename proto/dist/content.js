let l=null;const N="{BABADOOK}",f=1e6;function w(e){return e instanceof HTMLInputElement&&(e.type||"").toLowerCase()==="password"}function d(e){if(!(e instanceof HTMLElement))return!1;const t=e.tagName.toLowerCase();if(t==="textarea")return!0;if(t==="input"){const o=e.type?.toLowerCase();return!(o==="hidden"||o==="button"||o==="submit"||o==="reset"||o==="image")}if(e.isContentEditable)return!0;const n=e.getAttribute("role");return n==="textbox"||n==="searchbox"}function h(e){return d(e)&&!w(e)}function x(){const e=document,t=e.doctype?`<!DOCTYPE ${e.doctype.name}${e.doctype.publicId?` PUBLIC "${e.doctype.publicId}"`:""}${e.doctype.systemId?` "${e.doctype.systemId}"`:""}>`:"";return t?t+`
`:""}function H(e){const t=[];let n=e;for(;n&&n.nodeType===1&&n!==document.documentElement;){const o=n.nodeName.toLowerCase();let i=1,r=n.previousElementSibling;for(;r;)r.nodeName.toLowerCase()===o&&i++,r=r.previousElementSibling;t.unshift(`${o}:nth-of-type(${i})`),n=n.parentElement}return"html>"+t.join(">")}function p(e,t){const n=[];let o=t;for(;o&&o!==e;){const i=o.parentNode;if(!i)return null;const r=Array.prototype.indexOf.call(i.childNodes,o);if(r<0)return null;n.push(r),o=i}return o!==e?null:(n.reverse(),n)}function m(e,t){if(!t)return null;let n=e;for(const o of t){const i=n.childNodes[o];if(!i)return null;n=i}return n}function M(e,t){const n=e.selectionStart??e.value.length,o=e.selectionEnd??e.value.length;return e.value.slice(0,n)+t+e.value.slice(o)}function b(e,t){const n=document.documentElement,o=n.cloneNode(!0),i=p(n,e),r=m(o,i);let c="";if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement)c=M(e,t),r instanceof HTMLInputElement?r.setAttribute("value",c):r&&r.tagName?.toLowerCase()==="textarea"&&(r.textContent=c);else if(e.isContentEditable){c="";const u=document.getSelection();if(u&&u.rangeCount&&e.contains(u.anchorNode)){const a=u.getRangeAt(0),T=p(n,a.startContainer),v=p(n,a.endContainer),g=m(o,T),C=m(o,v);if(g&&C){const s=document.createRange();s.setStart(g,a.startOffset),s.setEnd(C,a.endOffset),s.collapsed?(s.insertNode(document.createTextNode(t)),s.collapse(!0)):(s.deleteContents(),s.insertNode(document.createTextNode(t)),s.collapse(!1))}else r&&r.appendChild(document.createTextNode(t));r&&(c=r.innerHTML)}else r&&(r.appendChild(document.createTextNode(t)),c=r.innerHTML)}let L;return L=x()+(o.outerHTML??""),{fieldPreview:c,pageHTML:L}}function y(e,t){if(t)if(t.length<=f)console.log(e,t);else for(let n=0;n<t.length;n+=f)console.log(e,t.slice(n,n+f))}function E(e){const{fieldPreview:t,pageHTML:n}=b(e,N),o=H(e);t&&y(`FIELD_PREVIEW ${o}`,t),n&&y("PAGE_HTML_WITH_MARKER",n)}function I(e){const t=e.composedPath?.();if(t&&t.length){for(const o of t)if(o instanceof HTMLElement&&d(o))return o}const n=e.target;return d(n)?n:null}addEventListener("focusin",e=>{const t=e.target;l=d(t)?t:null,h(l)&&E(l)},!0);addEventListener("pointerdown",e=>{l=I(e)},!0);addEventListener("input",e=>{const t=e.target;h(t)&&E(t)},!0);addEventListener("keydown",e=>{(e.metaKey||e.ctrlKey)&&!e.shiftKey&&!e.altKey&&e.key.toLowerCase()==="j"&&h(l)&&(e.preventDefault(),E(l))},!0);
